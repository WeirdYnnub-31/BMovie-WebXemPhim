@model webxemphim.Models.Feedback
@{
    ViewData["Title"] = "Chi tiết phản hồi";
}

<div class="container mt-4">
    <div class="row justify-content-center">
        <div class="col-md-10">
            <div class="card bg-glass border-0 rounded-4">
                <div class="card-header bg-transparent border-0 pb-0">
                    <div class="d-flex justify-content-between align-items-center">
                        <h2 class="card-title mb-0">Chi tiết phản hồi</h2>
                        <span class="badge @GetStatusBadgeClass(Model.Status)">@GetStatusText(Model.Status)</span>
                    </div>
                </div>
                <div class="card-body">
                    <div class="mb-4">
                        <h5>Thông tin phản hồi</h5>
                        <hr />
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <strong>Tiêu đề:</strong><br />
                                @Model.Title
                            </div>
                            <div class="col-md-6 mb-3">
                                <strong>Loại:</strong><br />
                                @GetTypeText(Model.Type)
                            </div>
                            @if (Model.Movie != null)
                            {
                                <div class="col-md-6 mb-3">
                                    <strong>Phim:</strong><br />
                                    <a href="@Url.Action("Watch", "Movies", new { slug = Model.Movie.Slug })">@Model.Movie.Title</a>
                                </div>
                            }
                            <div class="col-md-6 mb-3">
                                <strong>Ngày gửi:</strong><br />
                                @Model.CreatedAt.ToString("dd/MM/yyyy HH:mm")
                            </div>
                            @if (!string.IsNullOrEmpty(Model.MovieSourceUrl))
                            {
                                <div class="col-12 mb-3">
                                    <strong>URL nguồn video:</strong><br />
                                    <a href="@Model.MovieSourceUrl" target="_blank">@Model.MovieSourceUrl</a>
                                </div>
                            }
                        </div>
                    </div>

                    <div class="mb-4">
                        <h5>Mô tả chi tiết</h5>
                        <hr />
                        <p>@Model.Description</p>
                    </div>

                    @if (!string.IsNullOrEmpty(Model.AdminResponse))
                    {
                        <div class="mb-4">
                            <h5>Phản hồi từ Admin</h5>
                            <hr />
                            <div class="alert alert-success bg-glass border-0 rounded-4">
                                @if (Model.Admin != null)
                                {
                                    <strong>@Model.Admin.UserName</strong><br />
                                }
                                @if (Model.ResolvedAt.HasValue)
                                {
                                    <small class="text-muted">@Model.ResolvedAt.Value.ToString("dd/MM/yyyy HH:mm")</small><br />
                                }
                                @Model.AdminResponse
                            </div>
                        </div>
                    }

                    <div class="d-flex gap-2">
                        <a href="@Url.Action("MyFeedbacks", "Feedback")" class="btn btn-outline-secondary">Quay lại</a>
                        @if (Model.Status == FeedbackStatus.Pending || Model.Status == FeedbackStatus.InProgress)
                        {
                            <a href="@Url.Action("Create", "Feedback", new { movieId = Model.MovieId })" class="btn btn-primary">Gửi phản hồi mới</a>
                        }
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

@functions {
    string GetStatusBadgeClass(FeedbackStatus status)
    {
        return status switch
        {
            FeedbackStatus.Pending => "bg-warning",
            FeedbackStatus.InProgress => "bg-info",
            FeedbackStatus.Resolved => "bg-success",
            FeedbackStatus.Rejected => "bg-danger",
            FeedbackStatus.Duplicate => "bg-secondary",
            _ => "bg-secondary"
        };
    }

    string GetStatusText(FeedbackStatus status)
    {
        return status switch
        {
            FeedbackStatus.Pending => "Chờ xử lý",
            FeedbackStatus.InProgress => "Đang xử lý",
            FeedbackStatus.Resolved => "Đã xử lý",
            FeedbackStatus.Rejected => "Từ chối",
            FeedbackStatus.Duplicate => "Trùng lặp",
            _ => "Không xác định"
        };
    }

    string GetTypeText(FeedbackType type)
    {
        return type switch
        {
            FeedbackType.MovieError => "Phim không phát được",
            FeedbackType.VideoQuality => "Chất lượng video kém",
            FeedbackType.SubtitleError => "Lỗi phụ đề",
            FeedbackType.AudioError => "Lỗi âm thanh",
            FeedbackType.BugReport => "Báo lỗi website",
            FeedbackType.FeatureRequest => "Yêu cầu tính năng mới",
            FeedbackType.Suggestion => "Góp ý cải tiến",
            FeedbackType.Other => "Khác",
            _ => "Không xác định"
        };
    }
}

