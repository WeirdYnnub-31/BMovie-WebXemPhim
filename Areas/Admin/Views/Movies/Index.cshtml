@model List<webxemphim.Models.Movie>
@{
    Layout = "~/Areas/Admin/Views/Shared/_Layout.cshtml";
    ViewData["Title"] = "Quáº£n lÃ½ phim";
}

@if (TempData["Message"] != null)
{
    <div class="alert alert-success alert-dismissible fade show" role="alert">
        @TempData["Message"]
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    </div>
}

<section class="mb-4">
    <div class="d-flex justify-content-between align-items-center mb-3">
        <h2 class="section-title mb-0">Quáº£n lÃ½ phim</h2>
        <div class="d-flex gap-2">
            <a class="btn btn-outline-light btn-sm" asp-area="Admin" asp-controller="Movies" asp-action="ImportOphim">Import Ophim</a>
            <a class="btn btn-outline-info btn-sm" asp-area="Admin" asp-controller="Movies" asp-action="ImportRophim">Import Rophim</a>
            <a class="neon-btn" asp-area="Admin" asp-controller="Movies" asp-action="Create">ThÃªm phim</a>
            <form method="post" asp-area="Admin" asp-controller="Movies" asp-action="DeleteAllMovies" class="d-inline" onsubmit="return confirm('âš ï¸ Cáº¢NH BÃO: Báº¡n cÃ³ cháº¯c cháº¯n muá»‘n xÃ³a Táº¤T Cáº¢ phim trong database? HÃ nh Ä‘á»™ng nÃ y khÃ´ng thá»ƒ hoÃ n tÃ¡c!\n\nTáº¥t cáº£ dá»¯ liá»‡u liÃªn quan (bÃ¬nh luáº­n, Ä‘Ã¡nh giÃ¡, nguá»“n phim, v.v.) cÅ©ng sáº½ bá»‹ xÃ³a.');">
                <button type="submit" class="btn btn-danger btn-sm">ğŸ—‘ï¸ XÃ³a táº¥t cáº£ phim</button>
            </form>
        </div>
    </div>
    <div class="section-bar mb-3"></div>
    <form method="get" class="glass-card p-3 mb-3">
        <div class="row g-2">
            <div class="col-md-4">
                <input class="form-control" name="q" value="@((string)ViewBag.Q ?? "")" placeholder="TÃ¬m tiÃªu Ä‘á»..." />
            </div>
            <div class="col-md-3">
                <select class="form-select" name="genreId">
                    <option value="">-- Thá»ƒ loáº¡i --</option>
                    @foreach (var g in (IEnumerable<webxemphim.Models.Genre>)ViewBag.GenreList){
                        if ((int?)ViewBag.FilterGenreId == g.Id){<option value="@g.Id" selected>@g.Name</option>} else {<option value="@g.Id">@g.Name</option>}
                    }
                </select>
            </div>
            <div class="col-md-2">
                <input class="form-control" name="year" value="@((int?)ViewBag.FilterYear)" placeholder="NÄƒm" />
            </div>
            <div class="col-md-2">
                <input class="form-control" name="imdbMin" value="@((double?)ViewBag.FilterImdb)" placeholder="IMDb â‰¥" />
            </div>
            <div class="col-md-3">
                <select class="form-select" name="sort">
                    @if ((string)ViewBag.Sort=="id_desc"){<option value="id_desc" selected>Má»›i nháº¥t</option>} else {<option value="id_desc">Má»›i nháº¥t</option>}
                    @if ((string)ViewBag.Sort=="title_asc"){<option value="title_asc" selected>TiÃªu Ä‘á» Aâ†’Z</option>} else {<option value="title_asc">TiÃªu Ä‘á» Aâ†’Z</option>}
                    @if ((string)ViewBag.Sort=="title_desc"){<option value="title_desc" selected>TiÃªu Ä‘á» Zâ†’A</option>} else {<option value="title_desc">TiÃªu Ä‘á» Zâ†’A</option>}
                    @if ((string)ViewBag.Sort=="year_desc"){<option value="year_desc" selected>NÄƒm â†“</option>} else {<option value="year_desc">NÄƒm â†“</option>}
                    @if ((string)ViewBag.Sort=="year_asc"){<option value="year_asc" selected>NÄƒm â†‘</option>} else {<option value="year_asc">NÄƒm â†‘</option>}
                    @if ((string)ViewBag.Sort=="imdb_desc"){<option value="imdb_desc" selected>IMDb â†“</option>} else {<option value="imdb_desc">IMDb â†“</option>}
                    @if ((string)ViewBag.Sort=="imdb_asc"){<option value="imdb_asc" selected>IMDb â†‘</option>} else {<option value="imdb_asc">IMDb â†‘</option>}
                </select>
            </div>
            <div class="col-md-2">
                <button class="neon-btn w-100" type="submit">Lá»c</button>
            </div>
        </div>
    </form>
    @{
        var currentPage = (int)(ViewBag.Page ?? 1);
        var pageSize = (int)(ViewBag.PageSize ?? 12);
    }
    <div class="glass-card p-0">
        <div class="table-responsive">
            <table class="table table-dark table-hover align-middle mb-0">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>TiÃªu Ä‘á»</th>
                        <th>NÄƒm</th>
                        <th>IMDb</th>
                        <th></th>
                    </tr>
                </thead>
                <tbody>
                @{
                    int index = 0;
                }
                @foreach (var m in Model)
                {
                    var sequentialNumber = (currentPage - 1) * pageSize + index + 1;
                    <tr>
                        <td>@sequentialNumber</td>
                        <td>@m.Title</td>
                        <td>@m.Year</td>
                        <td>@m.Imdb</td>
                        <td class="text-end">
                            <a class="btn btn-sm btn-outline-light" asp-area="Admin" asp-controller="Movies" asp-action="Edit" asp-route-id="@m.Id">Sá»­a</a>
                            <form method="post" asp-area="Admin" asp-controller="Movies" asp-action="Delete" asp-route-id="@m.Id" class="d-inline">
                                <button type="submit" class="btn btn-sm btn-danger" onclick="return confirm('XÃ³a phim?');">XÃ³a</button>
                            </form>
                        </td>
                    </tr>
                    index++;
                }
                </tbody>
            </table>
        </div>
    </div>
    @{
        var total = (int)(ViewBag.Total ?? 0);
        var totalPages = (int)Math.Ceiling(total / (double)pageSize);
    }
    @if (totalPages > 1)
    {
        <nav class="mt-3">
            <ul class="pagination pagination-sm">
                <li class="page-item @(currentPage<=1?"disabled":null)">
                    <a class="page-link" asp-area="Admin" asp-controller="Movies" asp-action="Index" asp-route-page="@(currentPage-1)" asp-route-pageSize="@pageSize">TrÆ°á»›c</a>
                </li>
                <li class="page-item disabled"><span class="page-link">Trang @currentPage/@totalPages</span></li>
                <li class="page-item @(currentPage>=totalPages?"disabled":null)">
                    <a class="page-link" asp-area="Admin" asp-controller="Movies" asp-action="Index" asp-route-page="@(currentPage+1)" asp-route-pageSize="@pageSize">Sau</a>
                </li>
            </ul>
        </nav>
    }
</section>


